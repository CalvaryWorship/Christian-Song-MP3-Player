<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Christian Song MP3 Player â€” Playlists</title>
<style>
:root{
  --bg:#0b1220;
  --card:#0f1724;
  --accent:#f6c85f;
  --muted:#9aa4b2;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  background:linear-gradient(180deg,#031022 0%,#071428 100%);
  color:#e6eef6;
}
body.overlay-active::before{
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 998;
}
.app{min-height:100vh;display:flex;gap:18px;padding:18px}
.sidebar {
  width: 260px;
  flex-shrink:0;
  transition: transform 0.3s ease;
}
.sidebar.hidden {
  transform: translateX(-100%);
}
.main{flex:1;min-width:320px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;box-shadow:0 8px 24px rgba(2,6,23,0.6)}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.search{flex:1}
.search input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.controls{display:flex;gap:8px;align-items:center}
.btn{padding:8px 10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:#fff}
.small{padding:6px 8px;font-size:13px}
.player{display:flex;gap:14px;align-items:center;margin-bottom:12px}
.cover{width:84px;height:84px;border-radius:10px;background:linear-gradient(135deg,#1f2937,#0b1220);display:flex;align-items:center;justify-content:center;font-size:36px}
.meta h2{margin:0 0 6px 0;font-size:18px}
.meta p{margin:0;color:var(--muted);font-size:13px}
.controls-row{display:flex;align-items:center;gap:10px;margin-top:10px}
.progress{display:flex;align-items:center;gap:12px;margin-top:12px}
.progress input[type=range]{flex:1}
.time{min-width:56px;text-align:center;color:var(--muted);font-size:13px}
.list{margin-top:12px;display:grid;gap:8px}
.song{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01)}
.song:hover{background:rgba(255,255,255,0.02)}
.song .idx{width:28px;text-align:center;color:var(--muted)}
.song .title{flex:1}
.song .actions{display:flex;gap:6px}
.playlist-item{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;margin-bottom:6px;background:rgba(255,255,255,0.01)}
.playlist-item .meta{flex:1;margin-left:8px}
.caption{color:var(--muted);font-size:13px;margin-top:8px}
.footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
.input{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.badge{background:rgba(246,200,95,0.12);padding:4px 8px;border-radius:999px;font-size:12px;color:var(--accent)}
.empty{color:var(--muted);font-size:13px;text-align:center;padding:12px}

/* Sidebar toggle button */
#sidebarToggle {
  display: none;
  position: fixed;
  top: 18px;
  left: 18px;
  z-index: 1000;
  padding: 8px 10px;
  background: var(--accent);
  color: #000;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
@media(max-width:768px){
  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    z-index: 999;
    padding: 18px;
    background: var(--bg);
    overflow-y: auto;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }
  .sidebar.show {
    transform: translateX(0);
  }
  #sidebarToggle { display: block; }
}
</style>
</head>
<body>

<button id="sidebarToggle">â˜°</button>

<div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <strong>Playlists</strong>
        <button class="btn small" id="newPlaylistBtn">+ New</button>
      </div>

      <div id="playlistsContainer"></div>

      <div class="caption">Click a playlist to view songs. Use Play to play entire list.</div>
    </div>
    <div style="height:12px"></div>
    <div class="card">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <strong>Now Playing</strong>
        <span id="nowCount" class="badge">0</span>
      </div>
      <div style="height:8px"></div>
      <div id="nowListPreview" class="caption empty">No song queued</div>
    </div>
  </aside>

  <main class="main">
    <div class="card">
      <div class="header">
        <div class="search">
          <input id="search" placeholder="Search songs by title or singer..." />
        </div>
        <div class="controls">
          <button class="btn" id="shuffle">Shuffle</button>
          <button class="btn" id="downloadAll">Download All</button>
        </div>
      </div>

      <div class="player">
        <div class="cover" id="cover">ðŸŽµ</div>
        <div class="meta">
          <h2 id="nowTitle">Select a song to play</h2>
          <p id="nowArtist">Calvary Worship</p>
          <div class="controls-row">
            <button class="btn" id="prev">Prev</button>
            <button class="btn play" id="play">Play</button>
            <button class="btn" id="next">Next</button>
            <label style="margin-left:8px;color:var(--muted)">Vol</label>
            <input id="volume" type="range" min="0" max="1" step="0.01" style="width:110px" />
          </div>
        </div>
      </div>

      <div class="progress">
        <div class="time" id="curTime">0:00</div>
        <input id="seek" type="range" min="0" max="100" value="0" />
        <div class="time" id="dur">0:00</div>
      </div>

      <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
        <button class="btn small" id="selectAllBtn">Select All</button>
        <button class="btn small" id="createPlaylistFromSelected">Create playlist from selected</button>
        <input id="newPlaylistName" class="input" placeholder="Enter playlist name (for quick create)" style="max-width:320px"/>
      </div>

      <!-- Back to All Songs Button -->
      <div style="margin-top:12px">
        <button class="btn small" id="backToAllBtn" style="display:none">â¬… Back to All Songs</button>
      </div>

      <div class="list" id="songs" style="margin-top:14px"></div>

      <div class="footer"> <code></code> </div>
    </div>
  </main>
</div>

<audio id="audio" preload="metadata"></audio>

<script>
const sidebar = document.getElementById('sidebar');
const toggleBtn = document.getElementById('sidebarToggle');

toggleBtn.addEventListener('click', (e)=>{
  e.stopPropagation();
  sidebar.classList.toggle('show');
  document.body.classList.toggle('overlay-active', sidebar.classList.contains('show'));
});
sidebar.addEventListener('click', (e)=> e.stopPropagation());
window.addEventListener('pointerdown', (e)=>{
  if(window.innerWidth <= 768 && !sidebar.contains(e.target) && e.target!==toggleBtn){
    sidebar.classList.remove('show');
    document.body.classList.remove('overlay-active');
  }
});

const SONGS=[
  {id:1,title:"Binti meri tujse hai parbhuj",artist:"Calvary Choir",src:"assets/Binti meri tujse hai parbhuj.mp3",cover:"assets/cover1.jpg"},
  {id:2,title:"Jal Ke Liye Hafti Hirni Jaise",artist:"Worship Team",src:"assets/Jal Ke Liye Hafti Hirni Jaise .mp3",cover:"assets/cover2.jpg"},
  {id:3,title:"Blessed Assurance (Sample)",artist:"Calvary Choir",src:"assets/blessed-assurance.mp3",cover:"assets/cover3.jpg"}
];

const songsEl=document.getElementById('songs');
const playlistsContainer=document.getElementById('playlistsContainer');
const audio=document.getElementById('audio');
const nowTitle=document.getElementById('nowTitle');
const nowArtist=document.getElementById('nowArtist');
const cover=document.getElementById('cover');
const playBtn=document.getElementById('play');
const prevBtn=document.getElementById('prev');
const nextBtn=document.getElementById('next');
const seek=document.getElementById('seek');
const curTime=document.getElementById('curTime');
const dur=document.getElementById('dur');
const volume=document.getElementById('volume');
const search=document.getElementById('search');
const shuffleBtn=document.getElementById('shuffle');
const downloadAll=document.getElementById('downloadAll');
const selectAllBtn=document.getElementById('selectAllBtn');
const createFromSelectedBtn=document.getElementById('createPlaylistFromSelected');
const newPlaylistNameInput=document.getElementById('newPlaylistName');
const newPlaylistBtn=document.getElementById('newPlaylistBtn');
const nowCount=document.getElementById('nowCount');
const nowListPreview=document.getElementById('nowListPreview');
const backToAllBtn=document.getElementById('backToAllBtn');

let filtered=SONGS.slice();
let playlists=JSON.parse(localStorage.getItem('playlists_v1'))||[];
let queue=[];
let currentIndex=-1;
let playingPlaylistId=null;

function savePlaylists(){localStorage.setItem('playlists_v1', JSON.stringify(playlists));}
function secsToTime(s){s=Math.floor(s||0); return `${Math.floor(s/60)}:${(s%60).toString().padStart(2,'0')}`;}

function renderList(list){
  songsEl.innerHTML='';
  if(list.length===0){ songsEl.innerHTML='<div class="empty">No songs found</div>'; return; }
  list.forEach((song,i)=>{
    const el=document.createElement('div');
    el.className='song';
    el.innerHTML=`
      <input type="checkbox" data-id="${song.id}" class="selCheckbox" />
      <div class="idx">${i+1}</div>
      <div class="title"><div style="font-weight:600">${song.title}</div><div style="font-size:13px;color:var(--muted)">${song.artist}</div></div>
      <div class="actions">
        <button class="btn small" onclick="playById(${song.id})">Play</button>
        <button class="btn small addBtn">Add âž•</button>
        <a class="btn small" href="${song.src}" download>Download</a>
      </div>`;
    const addBtn=el.querySelector('.addBtn');
    const menu=document.createElement('div'); menu.className='addMenu';
    el.querySelector('.actions').appendChild(menu);
    addBtn.onclick=(e)=>{
      e.stopPropagation();
      menu.style.display=menu.style.display==='block'?'none':'block';
      menu.innerHTML='';
      playlists.forEach(pl=>{
        const b=document.createElement('button'); b.textContent=pl.name;
        b.onclick=()=>{ if(!pl.ids.includes(song.id)) pl.ids.push(song.id); savePlaylists(); menu.style.display='none'; renderPlaylists(); alert(`Added to "${pl.name}"`); }; menu.appendChild(b);
      });
      const newBtn=document.createElement('button'); newBtn.textContent='+ New Playlist';
      newBtn.onclick=()=>{ const name=prompt('New playlist name:'); if(!name) return; const pl={id:Date.now(),name:name.trim(),ids:[song.id]}; playlists.push(pl); savePlaylists(); menu.style.display='none'; renderPlaylists(); alert(`Created "${pl.name}" and added song`); };
      menu.appendChild(newBtn);
    };
    songsEl.appendChild(el);
  });
}

function renderPlaylists(){
  playlistsContainer.innerHTML='';
  if(playlists.length===0){ playlistsContainer.innerHTML='<div class="empty">No playlists yet</div>'; return; }
  playlists.slice().reverse().forEach(pl=>{
    const el=document.createElement('div'); el.className='playlist-item';
    el.innerHTML=`
      <div style="display:flex;align-items:center">
        <button class="btn small" onclick="playPlaylist(${pl.id})">Play</button>
        <div class="meta">
          <div style="font-weight:600">${pl.name}</div>
          <div style="font-size:12px;color:var(--muted)">${pl.ids.length} songs</div>
        </div>
      </div>
      <div style="display:flex;gap:6px">
        <button class="btn small" onclick="viewPlaylist(${pl.id})">View</button>
        <button class="btn small" onclick="deletePlaylist(${pl.id})">Delete</button>
      </div>`;
    playlistsContainer.appendChild(el);
  });
}

// --- Play / Queue ---
function loadSongByIndex(i){
  if(i<0||i>=queue.length) return;
  const s=queue[i]; audio.src=s.src; nowTitle.textContent=s.title; nowArtist.textContent=s.artist;
  cover.style.backgroundImage=s.cover?`url(${s.cover})`:''; cover.textContent=s.cover?'ðŸŽµ':'ðŸŽµ';
  currentIndex=i; updateNowPreview();
}
function playById(id){
  if(queue.length===0){ queue=filtered.slice(); }
  const idx=queue.findIndex(s=>s.id===id);
  if(idx===-1){ const s=SONGS.find(x=>x.id===id); queue=[s]; playingPlaylistId=null; loadSongByIndex(0); }
  else loadSongByIndex(idx);
  audio.play();
}
playBtn.onclick=()=>{ audio.paused?audio.play():audio.pause(); };
prevBtn.onclick=()=>{ if(currentIndex>0) loadSongByIndex(currentIndex-1); else loadSongByIndex(queue.length-1); audio.play(); };
nextBtn.onclick=()=>{ if(currentIndex<queue.length-1) loadSongByIndex(currentIndex+1); else loadSongByIndex(0); audio.play(); };
audio.onplay=()=>playBtn.textContent='Pause';
audio.onpause=()=>playBtn.textContent='Play';
audio.ontimeupdate=()=>{ if(audio.duration){ seek.max=Math.floor(audio.duration); seek.value=Math.floor(audio.currentTime); curTime.textContent=secsToTime(audio.currentTime); dur.textContent=secsToTime(audio.duration); } };
audio.onended=()=>{ if(currentIndex<queue.length-1){ loadSongByIndex(currentIndex+1); audio.play(); } else audio.pause(); };
seek.oninput=()=>audio.currentTime=seek.value;
volume.oninput=()=>audio.volume=volume.value; volume.value=0.9; audio.volume=0.9;

// Search & shuffle
search.oninput = () => {
  const q = search.value.toLowerCase().trim();
  if (q) {
    filtered = SONGS.filter(s => s.title.toLowerCase().includes(q) || s.artist.toLowerCase().includes(q));
    backToAllBtn.style.display = 'inline-block'; // show back button when searching
  } else {
    filtered = SONGS.slice();
    backToAllBtn.style.display = 'none'; // hide back button if search cleared
  }
  renderList(filtered);
};

shuffleBtn.onclick=()=>{ for(let i=filtered.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [filtered[i],filtered[j]]=[filtered[j],filtered[i]] } renderList(filtered); };
downloadAll.onclick=()=>filtered.forEach(s=>{ const a=document.createElement('a'); a.href=s.src; a.download=''; a.click(); });

// Select & create playlist
selectAllBtn.onclick=()=>{ const boxes=Array.from(document.querySelectorAll('.selCheckbox')); const allChecked=boxes.every(b=>b.checked); boxes.forEach(b=>b.checked=!allChecked); };
createFromSelectedBtn.onclick=()=>{
  const name=(newPlaylistNameInput.value||prompt('Playlist name'))?.trim(); if(!name) return alert('Playlist name required');
  const ids=Array.from(document.querySelectorAll('.selCheckbox:checked')).map(cb=>parseInt(cb.dataset.id));
  if(ids.length===0) return alert('Select at least one song to create playlist');
  const playlist={id:Date.now(),name,ids}; playlists.push(playlist); savePlaylists(); renderPlaylists(); newPlaylistNameInput.value=''; alert(`Playlist "${name}" created (${ids.length} songs)`);
};
newPlaylistBtn.onclick=()=>{ const name=prompt('New playlist name:'); if(!name) return; playlists.push({id:Date.now(),name:name.trim(),ids:[]}); savePlaylists(); renderPlaylists(); };

// Playlist actions
window.playPlaylist=(plId)=>{ const pl=playlists.find(p=>p.id===plId); if(!pl) return alert('Playlist not found'); queue=pl.ids.map(id=>SONGS.find(s=>s.id===id)).filter(Boolean); playingPlaylistId=plId; updateNowPreview(); if(queue.length) { loadSongByIndex(0); audio.play(); } };
window.viewPlaylist=(plId)=>{
  const pl=playlists.find(p=>p.id===plId); if(!pl) return alert('Playlist not found');
  filtered=SONGS.filter(s=>pl.ids.includes(s.id)); renderList(filtered);
  backToAllBtn.style.display='inline-block'; // show back button
};
window.deletePlaylist=(plId)=>{ if(!confirm('Delete this playlist?')) return; playlists=playlists.filter(p=>p.id!==plId); savePlaylists(); renderPlaylists(); };

// Back to all songs button
backToAllBtn.onclick = () => {
  filtered = SONGS.slice();
  renderList(filtered);
  backToAllBtn.style.display = 'none';
  search.value = '';
  window.scrollTo({ top: 0, behavior: 'smooth' });
};

// Update now playing preview
function updateNowPreview(){
  nowCount.textContent=queue.length;
  nowListPreview.innerHTML=queue.length?queue.map(s=>s.title).join('<br>'):'No song queued';
}

// Initial render
renderList(filtered);
renderPlaylists();
</script>
</body>
</html>
